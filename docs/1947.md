# å¦‚ä½•åœ¨ JavaScript ä¸­ä½¿ç”¨é—­åŒ…â€”â€”åˆå­¦è€…æŒ‡å—

> åŸæ–‡ï¼š<https://www.freecodecamp.org/news/closures-in-javascript/>

é—­åŒ…æ˜¯ä¸€ä¸ªå¾ˆéš¾å­¦ä¹ çš„ JavaScript æ¦‚å¿µï¼Œå› ä¸ºå¾ˆéš¾çœ‹å‡ºå®ƒä»¬å®é™…ä¸Šæ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚

ä¸å‡½æ•°ã€å˜é‡å’Œå¯¹è±¡ç­‰å…¶ä»–æ¦‚å¿µä¸åŒï¼Œæ‚¨å¹¶ä¸æ€»æ˜¯è‡ªè§‰è€Œç›´æ¥åœ°ä½¿ç”¨é—­åŒ…ã€‚ä½ ä¸è¦è¯´:å“¦ï¼è¿™é‡Œæˆ‘å°†ä½¿ç”¨é—­åŒ…ä½œä¸ºè§£å†³æ–¹æ¡ˆã€‚

ä½†åŒæ—¶ï¼Œä½ å¯èƒ½å·²ç»ä½¿ç”¨è¿™ä¸ªæ¦‚å¿µä¸€ç™¾æ¬¡äº†ã€‚å­¦ä¹ é—­åŒ…æ›´å¤šçš„æ˜¯è¯†åˆ«é—­åŒ…ä½•æ—¶è¢«ä½¿ç”¨ï¼Œè€Œä¸æ˜¯å­¦ä¹ ä¸€ä¸ªæ–°æ¦‚å¿µã€‚

## JavaScript ä¸­çš„é—­åŒ…æ˜¯ä»€ä¹ˆï¼Ÿ

å½“ä¸€ä¸ªå‡½æ•°è¯»å–æˆ–ä¿®æ”¹ä¸€ä¸ªåœ¨å®ƒçš„ä¸Šä¸‹æ–‡ä¹‹å¤–å®šä¹‰çš„å˜é‡çš„å€¼æ—¶ï¼Œä½ å°±æœ‰äº†ä¸€ä¸ªé—­åŒ…ã€‚

```
const value = 1
function doSomething() {
    let data = [1,2,3,4,5,6,7,8,9,10,11]
    return data.filter(item => item % value === 0)
} 
```

è¿™é‡Œå‡½æ•°`doSomething`ä½¿ç”¨äº†å˜é‡`value`ã€‚ä½†æ˜¯å‡½æ•°`item => item % value === 0`ä¹Ÿå¯ä»¥è¿™æ ·å†™:

```
function(item){
    return item % value === 0
} 
```

æ‚¨ä½¿ç”¨åœ¨å‡½æ•°æœ¬èº«ä¹‹å¤–å®šä¹‰çš„å˜é‡`value`çš„å€¼ã€‚

## å‡½æ•°å¯ä»¥è®¿é—®ä¸Šä¸‹æ–‡ä¹‹å¤–çš„å€¼

ä¸å‰é¢çš„ç¤ºä¾‹ä¸€æ ·ï¼Œå‡½æ•°å¯ä»¥è®¿é—®å’Œä½¿ç”¨åœ¨å…¶â€œä¸»ä½“â€æˆ–ä¸Šä¸‹æ–‡ä¹‹å¤–å®šä¹‰çš„å€¼ï¼Œä¾‹å¦‚:

```
let count = 1
function counter() {
    console.log(count)
}
counter() // print 1
count = 2
counter() // print 2 
```

è¿™å…è®¸æˆ‘ä»¬åœ¨æ¨¡å—çš„ä»»ä½•åœ°æ–¹ä¿®æ”¹`count`å˜é‡çš„å€¼ã€‚ç„¶åå½“è®¡æ•°å™¨å‡½æ•°è¢«è°ƒç”¨æ—¶ï¼Œå®ƒä¼šçŸ¥é“å¦‚ä½•ä½¿ç”¨å½“å‰å€¼ã€‚

## æˆ‘ä»¬ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å‡½æ•°ï¼Ÿ

ä½†æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬è¦åœ¨ç¨‹åºä¸­ä½¿ç”¨å‡½æ•°å‘¢ï¼Ÿå½“ç„¶ï¼Œä¸ä½¿ç”¨æˆ‘ä»¬å®šä¹‰çš„å‡½æ•°æ¥ç¼–å†™ç¨‹åºæ˜¯å¯èƒ½çš„â€”â€”è™½ç„¶å›°éš¾ï¼Œä½†ä¹Ÿæ˜¯å¯èƒ½çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦åˆ›å»ºé€‚å½“çš„å‡½æ•°å‘¢ï¼Ÿ

æƒ³è±¡ä¸€æ®µä»£ç ï¼Œå®ƒåšäº†ä¸€äº›å¥‡å¦™çš„äº‹æƒ…ï¼Œæ— è®ºå¦‚ä½•ï¼Œå®ƒæ˜¯ç”± X è¡Œä»£ç ç»„æˆçš„ã€‚

```
/* My wonderful piece of code */ 
```

ç°åœ¨å‡è®¾ä½ å¿…é¡»åœ¨ç¨‹åºçš„ä¸åŒéƒ¨åˆ†ä½¿ç”¨è¿™æ®µ**ç¾å¦™çš„ä»£ç **ï¼Œä½ ä¼šæ€ä¹ˆåšï¼Ÿã€‚

â€œè‡ªç„¶â€çš„é€‰æ‹©æ˜¯å°†è¿™æ®µä»£ç æ”¾å…¥ä¸€ä¸ªå¯é‡ç”¨çš„é›†åˆä¸­ï¼Œè¿™ä¸ªå¯é‡ç”¨çš„é›†åˆå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„å‡½æ•°ã€‚å‡½æ•°æ˜¯åœ¨ç¨‹åºä¸­é‡ç”¨å’Œå…±äº«ä»£ç çš„æœ€ä½³æ–¹å¼ã€‚

ç°åœ¨ï¼Œæ‚¨å¯ä»¥å°½å¯èƒ½å¤šåœ°ä½¿ç”¨æ‚¨çš„å‡½æ•°ã€‚å¹¶ä¸”ï¼Œå¿½ç•¥ä¸€äº›ç‰¹æ®Šçš„æƒ…å†µï¼Œè°ƒç”¨ä½ çš„å‡½æ•° N æ¬¡å°±ç­‰åŒäºç¼–å†™é‚£æ®µç²¾å½©çš„ä»£ç  N æ¬¡ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„æ›¿æ¢ã€‚

## ä½†æ˜¯ç»ˆç»“åœ¨å“ªé‡Œå‘¢ï¼Ÿ

ä½¿ç”¨åä¾‹ï¼Œè®©æˆ‘ä»¬æŠŠå®ƒçœ‹ä½œæ˜¯**æ®µç²¾å½©çš„ä»£ç ã€‚**

```
let count = 1
function counter() {
    console.log(count)
}
counter() // print 1 
```

ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³åœ¨è®¸å¤šéƒ¨åˆ†é‡ç”¨å®ƒï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å®ƒâ€œåŒ…è£…â€åœ¨ä¸€ä¸ªå‡½æ•°ä¸­ã€‚

```
function wonderfulFunction() {
    let count = 1
    function counter() {
        console.log(count)
    }
    counter() // print 1
} 
```

ç°åœ¨æˆ‘ä»¬æœ‰ä»€ä¹ˆï¼Ÿä¸€ä¸ªå‡½æ•°:`counter`ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªåœ¨å®ƒä¹‹å¤–å£°æ˜çš„å€¼`count`ã€‚å’Œä¸€ä¸ªå€¼:`count`ï¼Œå®ƒåœ¨`wonderfulFunction`å‡½æ•°èŒƒå›´å†…å£°æ˜ï¼Œä½†åœ¨`counter`å‡½æ•°å†…ä½¿ç”¨ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒä½¿ç”¨äº†ä¸€ä¸ªåœ¨å…¶ä¸Šä¸‹æ–‡ä¹‹å¤–å£°æ˜çš„å€¼:**é—­åŒ…**ã€‚

å¾ˆç®€å•ï¼Œä¸æ˜¯å—ï¼Ÿç°åœ¨ï¼Œå½“å‡½æ•°`wonderfulFunction`è¢«æ‰§è¡Œæ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿä¸€æ—¦æ‰§è¡Œäº†**çˆ¶**å‡½æ•°ï¼Œå˜é‡`count`å’Œå‡½æ•°`counter`ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

å…¶ä½“ä¸­å£°æ˜çš„å˜é‡å’Œå‡½æ•°*â€œæ¶ˆå¤±â€*(åƒåœ¾æ”¶é›†å™¨)ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸€ä¸‹è¿™ä¸ªä¾‹å­:

```
function wonderfulFunction() {
    let count = 1
    function counter() {
        count++
        console.log(count)
    }
   setInterval(counter, 2000)
}
wonderfulFunction() 
```

ç°åœ¨åœ¨`wonderfulFunction`ä¸­å£°æ˜çš„å˜é‡å’Œå‡½æ•°ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å‘Šè¯‰æµè§ˆå™¨æ¯ 2 ç§’é’Ÿè¿è¡Œä¸€æ¬¡`counter`ã€‚å› æ­¤ JavaScript å¼•æ“å¿…é¡»ä¿å­˜å¯¹å‡½æ•°çš„å¼•ç”¨ä»¥åŠå®ƒæ‰€ä½¿ç”¨çš„å˜é‡çš„å¼•ç”¨ã€‚å³ä½¿åœ¨çˆ¶å‡½æ•°`wonderfulFunction`å®Œæˆå…¶æ‰§è¡Œå‘¨æœŸåï¼Œå‡½æ•°`counter`å’Œå€¼è®¡æ•°ä»ç„¶ä¼šâ€œ*æ´»â€*ã€‚

æ‹¥æœ‰é—­åŒ…çš„è¿™ç§â€œæ•ˆæœâ€çš„å‡ºç°æ˜¯å› ä¸º JavaScript æ”¯æŒå‡½æ•°çš„åµŒå¥—ã€‚æˆ–è€…æ¢å¥è¯è¯´ï¼Œå‡½æ•°æ˜¯è¯­è¨€ä¸­çš„ç¬¬ä¸€ç±»å…¬æ°‘ï¼Œä½ å¯ä»¥åƒä½¿ç”¨ä»»ä½•å…¶ä»–å¯¹è±¡ä¸€æ ·ä½¿ç”¨å®ƒä»¬:åµŒå¥—ã€ä½œä¸ºå‚æ•°ä¼ é€’ã€ä½œä¸ºè¿”å›å€¼ç­‰ç­‰ã€‚

## åœ¨ JavaScript ä¸­æˆ‘å¯ä»¥ç”¨é—­åŒ…åšä»€ä¹ˆï¼Ÿ

### **ç«‹å³è°ƒç”¨çš„å‡½æ•°è¡¨è¾¾å¼(life)**

è¿™æ˜¯ä¸€ç§åœ¨ ES5 æ—¶ä»£è¢«å¹¿æ³›ä½¿ç”¨çš„æŠ€æœ¯ï¼Œç”¨æ¥å®ç°â€œæ¨¡å—â€è®¾è®¡æ¨¡å¼(åœ¨å®ƒè¢«æœ¬åœ°æ”¯æŒä¹‹å‰)ã€‚è¿™ä¸ªæƒ³æ³•æ˜¯å°†ä½ çš„æ¨¡å—â€œåŒ…è£…â€åœ¨ä¸€ä¸ªå¯ä»¥ç«‹å³æ‰§è¡Œçš„å‡½æ•°ä¸­ã€‚

```
(function(arg1, arg2){
...
...
})(arg1, arg2) 
```

è¿™å…è®¸æ‚¨åœ¨å‡½æ•°ä¸­ä½¿ç”¨åªèƒ½ç”±æ¨¡å—æœ¬èº«ä½¿ç”¨çš„ç§æœ‰å˜é‡â€”â€”ä¹Ÿå°±æ˜¯è¯´ï¼Œå…è®¸å®ƒæ¨¡æ‹Ÿè®¿é—®ä¿®é¥°ç¬¦ã€‚

```
const module = (function(){
	function privateMethod () {
	}
	const privateValue = "something"
	return {
	  get: privateValue,
	  set: function(v) { privateValue = v }
	}
})()

var x = module()
x.get() // "something"
x.set("Another value")
x.get() // "Another Value"
x.privateValue //Error 
```

### **åŠŸèƒ½å·¥å‚**

å¾—ç›Šäºé—­åŒ…å®ç°çš„å¦ä¸€ä¸ªè®¾è®¡æ¨¡å¼æ˜¯â€œå‡½æ•°å·¥å‚â€ã€‚è¿™æ˜¯å‡½æ•°åˆ›å»ºå‡½æ•°æˆ–å¯¹è±¡çš„æ—¶å€™ï¼Œä¾‹å¦‚ï¼Œå…è®¸æ‚¨åˆ›å»ºç”¨æˆ·å¯¹è±¡çš„å‡½æ•°ã€‚

```
 const createUser = ({ userName, avatar }) => ({
      id: createID(),
      userName,
      avatar,
      changeUserName (userName) {
        this.userName = userName;
        return this;
      },
      changeAvatar (url) {
        // execute some logic to retrieve avatar image
        const newAvatar = fetchAvatarFromUrl(url)
        this.avatar = newAvatar
        return this
      }
    });

        console.log(createUser({ userName: 'Bender', avatar: 'bender.png' }));

    {
      "id":"17hakg9a7jas",
      "avatar": "bender.png",
      "userName": "Bender",
      "changeUsername": [Function changeUsername]
      "changeAvatar": [Function changeAvatar]

    }
    */c
```

ä½¿ç”¨è¿™ç§æ¨¡å¼ï¼Œä½ å¯ä»¥å®ç°ä¸€ç§å«åš **currying** çš„å‡½æ•°å¼ç¼–ç¨‹æ€æƒ³ã€‚

### **é˜¿è°€å¥‰æ‰¿**

Currying æ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼(ä¹Ÿæ˜¯ä¸€äº›è¯­è¨€çš„ä¸€ä¸ªç‰¹å¾),åœ¨è¿™ç§æ¨¡å¼ä¸‹ï¼Œå‡½æ•°è¢«ç«‹å³æ±‚å€¼å¹¶è¿”å›ç¬¬äºŒä¸ªå‡½æ•°ã€‚è¿™ç§æ¨¡å¼å…è®¸æ‚¨æ‰§è¡Œä¸“é—¨åŒ–å’Œç»„åˆã€‚

æ‚¨ä½¿ç”¨é—­åŒ…æ¥åˆ›å»ºè¿™äº›â€œå®šåˆ¶çš„â€å‡½æ•°ï¼Œå®šä¹‰å¹¶è¿”å›é—­åŒ…çš„å†…éƒ¨å‡½æ•°ã€‚

```
function multiply(a) {

    return function (b) {
        return function (c)  {
            return a * b * c
        }
    }
}
let mc1 = multiply(1);
let mc2 = mc1(2);
let res = mc2(3);
console.log(res);

let res2 = multiply(1)(2)(3);
console.log(res2); 
```

è¿™äº›ç±»å‹çš„å‡½æ•°æ¥å—å•ä¸ªå€¼æˆ–å‚æ•°ï¼Œå¹¶è¿”å›å¦ä¸€ä¸ªä¹Ÿæ¥å—å‚æ•°çš„å‡½æ•°ã€‚è¿™æ˜¯å‚æ•°çš„éƒ¨åˆ†åº”ç”¨ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ ES6 é‡å†™è¿™ä¸ªä¾‹å­ã€‚

```
let multiply = (a) => (b) => (c) => {

    return a * b * c;
}

let mc1 = multiply(1);
let mc2 = mc1(2);
let res = mc2(3);
console.log(res);

let res2 = multiply(1)(2)(3);
console.log(res2); 
```

æˆ‘ä»¬å¯ä»¥åœ¨å“ªé‡Œç”³è¯· curryingï¼Ÿåœ¨ composition ä¸­ï¼Œå‡è®¾æ‚¨æœ‰ä¸€ä¸ªåˆ›å»º HTML å…ƒç´ çš„å‡½æ•°ã€‚

```
function createElement(element){
    const el = document.createElement(element)
    return function(content) {
        return el.textNode = content
    }
}

const bold = crearElement('b')
const italic = createElement('i')
const content = 'My content'
const myElement  = bold(italic(content)) // <b><i>My content</i></b> 
```

### **äº‹ä»¶ç›‘å¬å™¨**

å¦ä¸€ä¸ªå¯ä»¥ä½¿ç”¨å’Œåº”ç”¨é—­åŒ…çš„åœ°æ–¹æ˜¯åœ¨ä½¿ç”¨ React çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸­ã€‚

å‡è®¾æ‚¨ä½¿ç”¨ç¬¬ä¸‰æ–¹åº“æ¥å‘ˆç°æ•°æ®é›†åˆä¸­çš„é¡¹ç›®ã€‚è¿™ä¸ªåº“å…¬å¼€äº†ä¸€ä¸ªåä¸º`RenderItem`çš„ç»„ä»¶ï¼Œå®ƒåªæœ‰ä¸€ä¸ªå¯ç”¨çš„å±æ€§`onClick`ã€‚è¯¥å±æ€§ä¸æ¥æ”¶ä»»ä½•å‚æ•°ï¼Œä¹Ÿä¸è¿”å›å€¼ã€‚

ç°åœ¨ï¼Œåœ¨æ‚¨çš„ç‰¹å®šåº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨è¦æ±‚å½“ç”¨æˆ·å•å‡»é¡¹ç›®æ—¶ï¼Œåº”ç”¨ç¨‹åºæ˜¾ç¤ºå¸¦æœ‰é¡¹ç›®æ ‡é¢˜çš„è­¦å‘Šã€‚ä½†æ˜¯æ‚¨å¯ç”¨çš„`onClick`äº‹ä»¶ä¸æ¥å—å‚æ•°â€”â€”é‚£ä¹ˆæ‚¨èƒ½åšä»€ä¹ˆå‘¢ï¼Ÿ**å…³é—­ä»¥æ‹¯æ•‘**:

```
// Closure
// with es5
function onItemClick(title) {
    return function() {
      alert("Clicked " + title)
    }
}
// with es6
const onItemClick = title => () => alert(`Clcked ${title}`)

return (
  <Container>
{items.map(item => {
return (
   <RenderItem onClick={onItemClick(item.title)}>
    <Title>{item.title}</Title>
  </RenderItem>
)
})}
</Container>
) 
```

åœ¨è¿™ä¸ªç®€åŒ–çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶æ‚¨æƒ³è¦æ˜¾ç¤ºçš„æ ‡é¢˜ï¼Œå¹¶è¿”å›å¦ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ»¡è¶³ RenderItem ä½œä¸ºé“å…·æ¥æ”¶çš„å‡½æ•°çš„å®šä¹‰ã€‚

## **ç»“è®º**

ä½ ç”šè‡³å¯ä»¥åœ¨ä¸çŸ¥é“ä½ æ­£åœ¨ä½¿ç”¨é—­åŒ…çš„æƒ…å†µä¸‹å¼€å‘ä¸€ä¸ªåº”ç”¨ã€‚ä½†æ˜¯çŸ¥é“å®ƒä»¬çš„å­˜åœ¨ä»¥åŠå®ƒä»¬æ˜¯å¦‚ä½•çœŸæ­£å·¥ä½œçš„ï¼Œä¼šåœ¨ä½ åˆ›å»ºè§£å†³æ–¹æ¡ˆæ—¶å¼€å¯æ–°çš„å¯èƒ½æ€§ã€‚

é—­åŒ…æ˜¯åˆšå¼€å§‹æ—¶å¾ˆéš¾ç†è§£çš„æ¦‚å¿µä¹‹ä¸€ã€‚ä½†æ˜¯ä¸€æ—¦ä½ çŸ¥é“ä½ åœ¨ä½¿ç”¨å®ƒä»¬å¹¶ç†è§£å®ƒä»¬ï¼Œå®ƒä¼šè®©ä½ å¢åŠ ä½ çš„å·¥å…·å¹¶æ¨è¿›ä½ çš„äº‹ä¸šã€‚

![English-Footer-Social-Card-1](img/de1b9d3f8689c74679c8c8bdd672961b.png)

ğŸ¦[åœ¨æ¨ç‰¹ä¸Šå…³æ³¨æˆ‘](https://twitter.com/matiasfha) âœ‰ï¸ [åŠ å…¥æ—¶äº‹é€šè®¯](https://matiashernandez.ck.page) â¤ï¸ [æ”¯æŒæˆ‘çš„å·¥ä½œ](https://buymeacoffee.com/matiasfha)