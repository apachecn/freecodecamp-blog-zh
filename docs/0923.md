# å¦‚ä½•ä½¿ç”¨ Phinx åœ¨ PHP ä¸­è¿ç§»æ•°æ®åº“

> åŸæ–‡ï¼š<https://www.freecodecamp.org/news/easy-database-migrations-in-php-using-phinx/>

æ„å»ºç°ä»£ web åº”ç”¨ç¨‹åºé€šå¸¸æ¶‰åŠå¤§é‡æ•°æ®ã€‚åœ¨å¼€å‘å’Œç”Ÿäº§è¿‡ç¨‹ä¸­ç®¡ç†è¿™äº›æ•°æ®(æ•°æ®åº“)å¯èƒ½ä¼šå¾ˆéº»çƒ¦ã€‚

å¦‚æœæœ‰ä¸æ­¢ä¸€ä¸ªå¼€å‘äººå‘˜ï¼Œä»¥åŠå¿…é¡»æ‰‹åŠ¨å®ç°å˜æ›´çš„å¤šä¸ªç¯å¢ƒï¼Œè¿™ä¸€ç‚¹å°¤å…¶æ­£ç¡®ã€‚

æ•°æ®åº“è¿ç§»å¸®åŠ©å¼€å‘äººå‘˜è·¨å¤šä¸ªç¯å¢ƒå’Œå¼€å‘äººå‘˜è½»æ¾ç®¡ç†è¿™äº›å˜åŒ–ã€‚

è¿™ç¯‡æ–‡ç« è§£é‡Šé“:

*   ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿ç§»ã€‚
*   å¦‚ä½•ä½¿ç”¨ Phinx åœ¨ PHP ä¸­å¼€å§‹æ•°æ®åº“è¿ç§»ï¼Ÿ
*   å¦‚ä½•ç®¡ç†æ•°æ®åº“ä¸­çš„è¡¨ï¼Ÿ

è¿™ç¯‡æ–‡ç« æ˜¯ä¸ºå…·æœ‰åŸºæœ¬ PHP çŸ¥è¯†çš„è¯»è€…å‡†å¤‡çš„ã€‚å®ƒå°†å¸®åŠ©æ‚¨å­¦ä¼šæ›´å®¹æ˜“(å’Œæ›´å¥½åœ°)ç®¡ç†æ‚¨çš„æ•°æ®åº“ã€‚

## ä»€ä¹ˆæ˜¯æ•°æ®åº“è¿ç§»ï¼Ÿ

åŸºæœ¬ä¸Šï¼Œè¿ç§»åŒ…å«æ‚¨å¸Œæœ›å¯¹æ•°æ®åº“è¿›è¡Œçš„æ›´æ”¹ã€‚è¿™äº›æ›´æ”¹å¯èƒ½æ˜¯åˆ›å»ºæˆ–åˆ é™¤è¡¨ã€æ·»åŠ æˆ–åˆ é™¤è¡¨ä¸­çš„æŸäº›å­—æ®µã€æ›´æ”¹åˆ—ç±»å‹ç­‰ç­‰ã€‚

è¿™äº›æ–‡ä»¶ä½¿å¾—è·¨å¤šä¸ªç³»ç»Ÿè¿›è¡Œç›¸åŒçš„æ›´æ”¹å˜å¾—å®¹æ˜“ï¼Œå› ä¸ºä»»ä½•äººéƒ½å¯ä»¥è¿è¡Œè¿™äº›æ–‡ä»¶ï¼Œå¹¶æ›´æ–°ä»–ä»¬çš„æ•°æ®åº“ã€‚

å› æ­¤ï¼Œåœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œå›¢é˜Ÿä¸­çš„ä¸€äº›å¼€å‘äººå‘˜å¯ä»¥å¯¹*ç”¨æˆ·*è¡¨è¿›è¡Œæ›´æ”¹ï¼Œä»¥å…è®¸*æ€§åˆ«*å­—æ®µæ¥å—æ¯”é»˜è®¤çš„*ç”·æ€§*å’Œ*å¥³æ€§*æ›´å¤šçš„é€‰é¡¹ï¼Œä¹Ÿè®¸è¿˜æœ‰ç¬¬ä¸‰ä¸ª*å…¶ä»–*é€‰é¡¹ã€‚

å®Œæˆè¿™ä¸€æ›´æ”¹åï¼Œå¼€å‘äººå‘˜åˆ›å»ºä¸€ä¸ªè¿ç§»ã€‚è¿™ç§è¿ç§»åŒ…æ‹¬ä»–ä»¬å¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ”¹â€”â€”åœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯å¯¹è¡¨ä¸­ä¸€åˆ—çš„æ›´æ”¹â€”â€”å…¶ä»–å¼€å‘äººå‘˜å¯ä»¥é€šè¿‡è¿è¡Œè¿ç§»è½»æ¾åœ°å°†è¿™ç§æ›´æ”¹åº”ç”¨åˆ°ä»–ä»¬è‡ªå·±çš„æœ¬åœ°æ•°æ®åº“ä¸­ã€‚

> è¿ç§»å°±åƒæ•°æ®åº“çš„ç‰ˆæœ¬æ§åˆ¶ï¼Œå…è®¸æ‚¨çš„å›¢é˜Ÿå®šä¹‰å’Œå…±äº«åº”ç”¨ç¨‹åºçš„æ•°æ®åº“æ¨¡å¼å®šä¹‰ã€‚å¦‚æœæ‚¨æ›¾ç»ä¸å¾—ä¸å‘Šè¯‰å›¢é˜Ÿæˆå‘˜åœ¨ä»æºä»£ç æ§åˆ¶ä¸­è·å–æ›´æ”¹åï¼Œæ‰‹åŠ¨å‘ä»–ä»¬çš„æœ¬åœ°æ•°æ®åº“æ¨¡å¼ä¸­æ·»åŠ ä¸€åˆ—ï¼Œé‚£ä¹ˆæ‚¨å°±é¢ä¸´ç€æ•°æ®åº“è¿ç§»å¯ä»¥è§£å†³çš„é—®é¢˜ã€‚- [æ‹‰å‹’ç»´å°”](https://laravel.com/docs/9.x/)

è®¸å¤šæµè¡Œçš„ web æ¡†æ¶å·²ç»å†…ç½®äº†å¯¹è¿ç§»çš„æ”¯æŒã€‚ä½†æ˜¯åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ¢ç´¢å¦‚ä½•åœ¨æ™®é€š PHP ä¸­ä½¿ç”¨è¿ç§»ã€‚

ç‚¹å‡»äº†è§£æ›´å¤šå…³äºæ•°æ®åº“è¿ç§»çš„ä¿¡æ¯[ã€‚](https://www.cloudbees.com/blog/database-migration)

## ä»€ä¹ˆæ˜¯ Phinxï¼Ÿ

> Phinx æ˜¯ä¸€ä¸ª PHP åº“ï¼Œå®ƒè®©ç®¡ç† PHP åº”ç”¨ç¨‹åºçš„æ•°æ®åº“è¿ç§»å˜å¾—éå¸¸ç®€å•ã€‚è²å°¼å…‹æ–¯

Phinx ä½¿å¾—è½»æ¾ç®¡ç†è¿ç§»æˆä¸ºå¯èƒ½ï¼Œæ— è®ºæ‚¨æ˜¯å¦ä½¿ç”¨ PHP æ¡†æ¶ã€‚å®ƒä¹Ÿå¾ˆå®¹æ˜“å®‰è£…(æˆ‘ä»¬å°†åœ¨åé¢çœ‹åˆ°)ã€‚

å®ƒé™„å¸¦äº†å‡ ä¸ªå‘½ä»¤æ¥ç®€åŒ–æ“ä½œã€‚å®ƒæ˜¯å®Œå…¨å¯å®šåˆ¶çš„(ä½ å¯ä»¥ç”¨å®ƒåšä»»ä½•ä½ æƒ³åšçš„äº‹ğŸ™ƒ).å®ƒè¿˜å¯ä»¥åœ¨å¤šç§ç¯å¢ƒä¸­å·¥ä½œï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥è¿›è¡Œä¸€äº›ç”Ÿäº§è¿ç§»ã€æµ‹è¯•è¿ç§»å’Œå¼€å‘è¿ç§»ã€‚

## Phinx å®‰è£…

å¯ä»¥ä½¿ç”¨ composer å°† Phinx æ·»åŠ åˆ°ä»»ä½• PHP é¡¹ç›®ä¸­ã€‚

```
$ mkdir php-migrations
$ cd php-migrations
$ composer init
```

ç¬¬ä¸€ä¸ªå‘½ä»¤åœ¨å½“å‰ç›®å½•`php-migrations`ä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œç¬¬äºŒä¸ªå‘½ä»¤ç§»åŠ¨åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹ä¸­ã€‚æœ€åä¸€ä¸ªå‘½ä»¤å¯åŠ¨ä¸€ä¸ªäº¤äº’å¼ shellã€‚

æŒ‰ç…§æç¤ºï¼Œæ ¹æ®éœ€è¦å¡«å†™è¯¦ç»†ä¿¡æ¯(é»˜è®¤å€¼å³å¯)ã€‚æ‚¨å¯ä»¥è®¾ç½®é¡¹ç›®æè¿°ã€ä½œè€…å§“å(æˆ–è´¡çŒ®è€…å§“å)ã€ä¾èµ–å…³ç³»çš„æœ€ä½ç¨³å®šæ€§ã€é¡¹ç›®ç±»å‹ã€è®¸å¯è¯ï¼Œå¹¶å®šä¹‰æ‚¨çš„ä¾èµ–å…³ç³»ã€‚

å½“åˆ°è¾¾ä¾èµ–éƒ¨åˆ†æ—¶ï¼Œå®‰è£…`robmorgan/phinx` *phinx* åŒ…ä½œä¸ºä¾èµ–é¡¹ã€‚

æ¥å—å…¶ä»–é»˜è®¤å€¼ï¼Œå¹¶ç»§ç»­ç”Ÿæˆ`composer.json`æ–‡ä»¶ã€‚å½“å‰ç”Ÿæˆçš„æ–‡ä»¶åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

```
{
    "name": "zubair/php-migrations",
    "description": "A simple tutorial on how to use and manage migrations in PHP applications.",
    "type": "project",
    "require": {
        "robmorgan/phinx": "^0.12.10"
    },
    "license": "ISC",
    "autoload": {
        "psr-4": {
            "Zubs\\": "src/"
        }
    },
    "authors": [
        {
            "name": "Zubs",
            "email": "zubairidrisaweda@gmail.com"
        }
    ]
} 
```

Composer generated composer.json

## åˆå§‹åŒ– Phinx

å®‰è£… Phinx åï¼Œä½ éœ€è¦åˆå§‹åŒ–å®ƒã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®‰è£…åœ¨`vendor`æ–‡ä»¶å¤¹ä¸­çš„äºŒè¿›åˆ¶æ–‡ä»¶éå¸¸å®¹æ˜“åœ°åšåˆ°è¿™ä¸€ç‚¹ã€‚

```
$ ./vendor/bin/phinx init
```

è¿™å°† phinx çš„é…ç½®æ–‡ä»¶åˆ›å»ºä¸º PHP æ–‡ä»¶ã€‚å®ƒä¹Ÿå¯ä»¥åˆ›å»ºä¸º JSON æ–‡ä»¶ã€‚å¯¹äºé…ç½®ï¼Œæˆ‘æ›´å–œæ¬¢ JSONï¼Œæ‰€ä»¥æˆ‘å°†ä½¿ç”¨ JSON æ ¼å¼ã€‚

```
$ ./vendor/bin/phinx init --format=json
```

é»˜è®¤é…ç½®æ–‡ä»¶å¦‚ä¸‹æ‰€ç¤º:

```
{
    "paths": {
        "migrations": "%%PHINX_CONFIG_DIR%%/db/migrations",
        "seeds": "%%PHINX_CONFIG_DIR%%/db/seeds"
    },
    "environments": {
        "default_migration_table": "phinxlog",
        "default_environment": "development",
        "production": {
            "adapter": "mysql",
            "host": "localhost",
            "name": "production_db",
            "user": "root",
            "pass": "",
            "port": 3306,
            "charset": "utf8"
        },
        "development": {
            "adapter": "mysql",
            "host": "localhost",
            "name": "development_db",
            "user": "root",
            "pass": "",
            "port": 3306,
            "charset": "utf8"
        },
        "testing": {
            "adapter": "mysql",
            "host": "localhost",
            "name": "testing_db",
            "user": "root",
            "pass": "",
            "port": 3306,
            "charset": "utf8"
        }
    },
    "version_order": "creation"
} 
```

åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œæ³¨æ„ Phinx æœŸæœ›æ‚¨é»˜è®¤æ‹¥æœ‰ä¸€ä¸ª`db/migrations`è·¯å¾„(ç”¨äºæ‚¨çš„è¿ç§»)ã€‚å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥æŠŠå®ƒæ¢æ‰ï¼Œä½†æˆ‘è®¤ä¸ºå®ƒå¾ˆå¥½ï¼Œæˆ‘ä¼šç•™ç€å®ƒã€‚

```
$ mkdir db && db/migrations
```

ä½ å¯ä»¥åœ¨[å®˜æ–¹æ–‡æ¡£](https://book.cakephp.org/phinx/0/en/configuration.html)ä¸­è¯»åˆ°æ›´å¤šå…³äºè¿™äº›é…ç½®çš„ä¿¡æ¯ã€‚

Phinx è¿˜é™„å¸¦äº†ä¸åŒåŠ¨ä½œçš„å‘½ä»¤ï¼Œä»¥ä¾¿åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­æ›´å®¹æ˜“ä½¿ç”¨ã€‚

## å¦‚ä½•åˆ›å»ºè¿ç§»

Phinx ä½¿ç”¨ç±»è¿›è¡Œè¿ç§»ã€‚è¦åˆ›å»ºä¸€ä¸ªæ–°çš„è¿ç§»(æ¯”å¦‚åˆ›å»ºä¸€ä¸ª*å¸–å­*è¡¨)ï¼Œä½¿ç”¨å¸¦æœ‰è¿ç§»åç§°çš„`create`å‘½ä»¤ã€‚

```
$ ./vendor/bin/phinx create PostsTableMigration
```

![Screenshot-2022-03-28-at-13.22.17](img/d5acf7a6d15a4a4c5d857a0f4048d14c.png)

Creating A Migration

è¿™å°†åœ¨ä¹‹å‰åˆ›å»ºçš„`db/migrations`ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª`20220328122134_posts_table_migration.php`æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ä½¿ç”¨`YYYYMMDDHHMMSS_my_new_migration.php`æ ¼å¼å‘½åã€‚åœ¨è¿™ç§æ ¼å¼ä¸­ï¼Œå‰ 14 ä¸ªå­—ç¬¦ *YYYYMMDDHHMMSS* è¡¨ç¤ºå½“å‰æ—¶é—´æˆ³ã€‚

``20220328122134_posts_table_migration.php`` ç›®å‰çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
<?php
declare(strict_types=1);

use Phinx\Migration\AbstractMigration;

final class PostsTableMigration extends AbstractMigration
{
    /**
     * Change Method.
     *
     * Write your reversible migrations using this method.
     *
     * More information on writing migrations is available here:
     * https://book.cakephp.org/phinx/0/en/migrations.html#the-change-method
     *
     * Remember to call "create()" or "update()" and NOT "save()" when working
     * with the Table class.
     */
    public function change(): void
    {

    }
} 
```

Newly created migration file

è¿™ä¸ªæ–‡ä»¶(ä»¥åŠæ‰€æœ‰å…¶ä»–ä½¿ç”¨ Phinx åˆ›å»ºçš„è¿ç§»)æ‰©å±•äº†`Phinx\Migration\AbstractMigration`ç±»ã€‚è¿™ä¸ªç±»åŒ…å«äº†ä½ ä¸æ•°æ®åº“äº¤äº’æ‰€éœ€çš„æ‰€æœ‰æ–¹æ³•ã€‚

è¿™ä¸ªè¿ç§»æ–‡ä»¶è¿˜åŒ…æ‹¬ä¸€ä¸ª`change`æ–¹æ³•ã€‚è¿™ç§æ–¹æ³•æœ€è¿‘åœ¨ Phinx 0 . 2 . 0 ç‰ˆæœ¬ä¸­å¼•å…¥ï¼Œä»¥å®ç° Phinx çš„å¯é€†è¿ç§»æ€æƒ³ã€‚

è¿™äº›æ˜¯åªæœ‰ä¸€ç§æ–¹æ³•çš„è¿ç§»æ–‡ä»¶ï¼Œ *changeï¼Œ*å®ƒåŒ…å«æ‰§è¡ŒæŸäº›åŠ¨ä½œçš„é€»è¾‘ï¼Œè®© Phinx å»æƒ³åŠæ³•é€†è½¬å®ƒã€‚è€Œä¸æ˜¯ä¼ ç»Ÿçš„ä½¿ç”¨ä¸¤ç§æ–¹æ³•ï¼Œ*å‘ä¸Š*å’Œ*å‘ä¸‹*ï¼Œæ¥åˆ›å»ºå’Œåè½¬åŠ¨ä½œã€‚

> Phinx ä»ç„¶å…è®¸ä½ ä½¿ç”¨ *up* å’Œ down æ–¹æ³•ã€‚ä½†æ˜¯å½“å®ƒä»¬ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå®ƒç»™äº† change æ–¹æ³•ä¼˜å…ˆæƒã€‚å®ƒå¿½ç•¥äº†å®ƒä»¬ã€‚

## å¦‚ä½•ç®¡ç†è¡¨æ ¼

è¡¨æ˜¯æ„å»ºç»“æ„åŒ–æ•°æ®åº“çš„åŸºç¡€ï¼Œä¹Ÿæ˜¯ Phinx æä¾›çš„æœ€é‡è¦çš„éƒ¨åˆ†ã€‚

ä½ å¯ä»¥ç”¨ PHP ä»£ç å’Œ Phinx è½»æ¾ç®¡ç†æ•°æ®åº“è¡¨ã€‚Phinx æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„`table()`æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æ£€ç´¢ä¸€ä¸ª*è¡¨*å¯¹è±¡çš„å®ä¾‹ã€‚

### å¦‚ä½•åˆ›å»ºè¡¨æ ¼

ä½¿ç”¨ Phinx åˆ›å»ºè¡¨æ ¼éå¸¸ç®€å•ã€‚ä½¿ç”¨å¸¦æœ‰è¡¨åçš„`table()`æ–¹æ³•åˆ›å»ºä¸€ä¸ª*è¡¨*å¯¹è±¡çš„æ–°å®ä¾‹ã€‚

```
$table = $this->table('posts');
```

æ¥ä¸‹æ¥ï¼Œæ‚¨å¯ä»¥æ·»åŠ åˆ—åŠå…¶è®¾ç½®ã€‚

```
$table->addColumn('title', 'string', ['limit' => 20])
	->addColumn('body', 'text')
    ->addColumn('cover_image', 'string')
    ->addTimestamps()
    ->addIndex(['title'], ['unique' => true]);
```

åœ¨è¿™é‡Œï¼Œæˆ‘åˆ›å»ºäº†åˆ—`title`ã€`body`ã€`cover_image`ã€`created_at`å’Œ`updated_at`ã€‚æˆ‘è¿˜å°†`title`çš„ç±»å‹è®¾ç½®ä¸ºåŒ…å« 20 ä¸ªæˆ–æ›´å°‘å­—ç¬¦çš„*å­—ç¬¦ä¸²*ã€‚

æˆ‘å°†`body`è®¾ç½®ä¸ºä¸€ä¸ªæ–‡æœ¬å­—æ®µï¼Œè¿™æ ·å®ƒå°±å¯ä»¥å­˜æ”¾é•¿æ–‡ã€‚`cover_image`ä¹Ÿæ˜¯ä¸€ä¸ª*å­—ç¬¦ä¸²*å­—æ®µï¼Œå®ƒä½¿ç”¨å­—ç¬¦ä¸²çš„é»˜è®¤å¤§å°(255)ã€‚

`created_at`å’Œ`updated_at`å­—æ®µæ˜¯åœ¨`addTimestamps()`æ–¹æ³•ä¸­è‡ªåŠ¨ç”Ÿæˆçš„æ—¶é—´æˆ³ã€‚

æœ€åï¼Œæˆ‘å°†`title` å­—æ®µè®¾ç½®ä¸ºå”¯ä¸€çš„(å°±åƒåœ¨çœŸå®çš„åšå®¢ä¸­ä¸€æ ·)ã€‚

æ‚¨å¯ä»¥é€šè¿‡æ£€æŸ¥[æœ‰æ•ˆåˆ—ç±»å‹](https://book.cakephp.org/phinx/0/en/migrations.html#valid-column-types)æ¥è·å¾—æ‰€æœ‰å¯ç”¨çš„åˆ—ç±»å‹ã€‚æ‚¨ä¹Ÿå¯ä»¥é€šè¿‡æ£€æŸ¥[æœ‰æ•ˆåˆ—é€‰é¡¹](https://book.cakephp.org/phinx/0/en/migrations.html#valid-column-options)æ¥è·å¾—æ‰€æœ‰å¯ç”¨çš„åˆ—é€‰é¡¹ã€‚

æœ€åï¼Œæ‚¨å¯ä»¥è¯´åº”è¯¥ä½¿ç”¨`create`æ–¹æ³•åˆ›å»ºæ•°æ®åº“ã€‚

```
$table->create();
```

æœ€åï¼Œæ‚¨çš„è¿ç§»æ–‡ä»¶çš„ *change* æ–¹æ³•åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

```
public function change(): void
{
    $table = $this->table('posts');

    $table->addColumn('title', 'string', ['limit' => 20])
        ->addColumn('body', 'text')
        ->addColumn('cover_image', 'string')
        ->addTimestamps()
        ->addIndex(['title'], ['unique' => true]);

     $table->create();
}
```

æˆ‘ä»¬ç°åœ¨å¯ä»¥è¿è¡Œè¿™ä¸ªè¿ç§»æ¥åˆ›å»ºæˆ‘ä»¬çš„è¡¨ã€‚

## å¦‚ä½•è¿è¡Œè¿ç§»

åˆ›å»ºè¿ç§»åï¼Œä¸‹ä¸€æ­¥æ˜¯åœ¨æ•°æ®åº“ä¸­å®æ–½è¿™äº›æ‰€éœ€çš„æ›´æ”¹ã€‚è¿è¡Œè¿ç§»å®é™…ä¸Šä¼šå¼ºåˆ¶æ‰§è¡Œè¿™äº›æ›´æ”¹ã€‚

```
$ ./vendor/bin/phinx migrate
```

![Screenshot-2022-03-29-at-18.54.56](img/37ae3b89b9f83e325d194cc32f696438.png)

Running a migration

æ­¤å›¾æ˜¾ç¤ºäº†è¿ç§»çš„ç»“æœã€‚æ‚¨å¯ä»¥çœ‹åˆ°è¿è¡Œè¿ç§»æ‰€èŠ±è´¹çš„æ—¶é—´ã€‚

ç°åœ¨ï¼Œå¦‚æœæ‚¨æ£€æŸ¥æ‚¨çš„æ•°æ®åº“ GUI å·¥å…·ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°, *posts* è¡¨æ˜¯ç”¨ä¸€ä¸ªé™„åŠ å­—æ®µ, *id* å­—æ®µåˆ›å»ºçš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å­—æ®µä¹Ÿæ˜¯ä¸»å­—æ®µã€‚å®ƒè¿˜ä¼šè‡ªåŠ¨é€’å¢ã€‚

![Screenshot-2022-03-29-at-19.00.27](img/566003cfe3493ac134a98ad2fb657801.png)

*posts* table.

æ‚¨å¯ä»¥é€šè¿‡å°†å…¶ä»–å­—æ®µæŒ‡å®šä¸ºä¸»å­—æ®µï¼Œæˆ–è€…å°† *id* å­—æ®µæ˜ å°„åˆ°æ‰€éœ€çš„ä¸»å­—æ®µï¼Œå°†ä¸»é”®æ›´æ”¹ä¸ºå…¶ä»–é”®ã€‚åè€…åŒ…æ‹¬æ™®é€š *id* å­—æ®µçš„è‡ªåŠ¨é€’å¢èƒ½åŠ›ã€‚

```
$table = $this->table('posts', [
    'id' => false,
    'primary_key' => ['posts_key']
]);

$table = $this->table('posts', [
    'id' => 'posts_key',
]);
```

Changing The Primary Key

åœ¨ç¬¬ä¸€ç§æ–¹æ³•ä¸­ï¼Œè¦ä½¿ç”¨çš„ä¸»é”®å¿…é¡»æ˜¯è¡¨ä¸Šçš„ä¸€åˆ—(å®ƒä¸æ˜¯è‡ªåŠ¨åˆ›å»ºçš„)ã€‚

æ‚¨è¿˜å¯ä»¥è®¾ç½®è¦è¿è¡Œè¿ç§»çš„ç¯å¢ƒã€‚

```
$ ./vendor/bin/phinx migrate -e testing
```

### å¦‚ä½•é€†è½¬ç§»æ°‘

è¿ç§»å¯ä»¥é€šè¿‡*åœæ­¢*æ¥é€†è½¬ã€‚è¿™ä¸è¿ç§»*åˆ°*çš„è¿‡ç¨‹ç›¸åã€‚å…ˆå‰åˆ›å»ºçš„è¡¨å°†è¢«åˆ é™¤ï¼Œæ·»åŠ çš„åˆ—å°†è¢«åˆ é™¤ï¼Œæ•°æ®åº“å°†è¿”å›åˆ°è¿ç§»å‰çš„åˆå§‹çŠ¶æ€ã€‚

```
$ ./vendor/bin/phinx rollback
```

![Screenshot-2022-03-29-at-18.56.46](img/d9b5faa48d835c5b9360681f3f0ec77f.png)

Reversing a migration

### å¦‚ä½•æ£€æŸ¥è¿ç§»çŠ¶æ€

éšç€åº”ç”¨ç¨‹åºè§„æ¨¡çš„å¢åŠ ï¼Œé¢„è®¡æ•°æ®åº“è¿ç§»ä¹Ÿä¼šå¢åŠ ã€‚å› æ­¤ï¼Œåœ¨æŸäº›æ—¶å€™ï¼Œæ‚¨å¯èƒ½å¸Œæœ›æ£€æŸ¥è¿ç§»çš„çŠ¶æ€ï¼Œä»¥äº†è§£å“ªäº›å·²ç»è¿è¡Œï¼Œå“ªäº›æ²¡æœ‰è¿è¡Œã€‚

```
$ ./vendor/bin/phinx status
```

![Screenshot-2022-03-29-at-18.58.07](img/cfb6826813ec473016d64cc5848f34df.png)

Checking migration status

### å¦‚ä½•åˆ é™¤è¡¨æ ¼

åœ¨*è¡¨*å¯¹è±¡ä¸Šï¼Œæ‚¨å¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ç”¨`drop`æ–¹æ³•ï¼Œç„¶åä½¿ç”¨`save`æ–¹æ³•æ¥ä¿å­˜æ›´æ”¹ã€‚

```
$this->table('posts')->drop()->save();
```

### å¦‚ä½•é‡å‘½åè¡¨æ ¼

```
$table = $this->table('posts');

$table->rename('articles')
    ->update();
```

è¦åˆ é™¤è¡¨æ ¼ï¼Œè¯·è·å–è¡¨æ ¼ã€‚ç„¶åä½¿ç”¨å¸¦æœ‰æ–°åç§°çš„`rename`æ–¹æ³•ï¼Œæ¥ç€ä½¿ç”¨`update`æ–¹æ³•æ¥ä¿å­˜è¿™ä¸ªæ›´æ”¹ã€‚

### å¦‚ä½•æ›´æ”¹è¡¨çš„ä¸»é”®

æ‚¨è¿˜å¯ä»¥éå¸¸å®¹æ˜“åœ°æ›´æ”¹è¡¨çš„ä¸»é”®ã€‚

```
$table = $this->table('posts');

$table->changePrimaryKey('new_primary_key');

$table->update();
```

## ç»“è®º

ç°åœ¨æ‚¨çŸ¥é“äº†å¦‚ä½•åœ¨ PHP åº”ç”¨ç¨‹åºä¸­è®¾ç½®è¿ç§»ã€‚

å¦‚æœ‰ä»»ä½•é—®é¢˜æˆ–ç›¸å…³å»ºè®®ï¼Œæ¬¢è¿è”ç³»æˆ‘åˆ†äº«ã€‚

è¦é˜…è¯»æ›´å¤šæˆ‘çš„æ–‡ç« æˆ–å…³æ³¨æˆ‘çš„å·¥ä½œï¼Œæ‚¨å¯ä»¥åœ¨ [LinkedIn](https://www.linkedin.com/in/idris-aweda-zubair-5433121a3/) ã€ [Twitter](https://twitter.com/AwedaIdris) å’Œ [Github](https://github.com/Zubs) ä¸Šä¸æˆ‘è”ç³»ã€‚åˆå¿«åˆç®€å•ï¼Œè¿˜å…è´¹ï¼