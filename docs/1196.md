# å¦‚ä½•åœ¨ Azure DevOps ä¸Šä¿æŒæ‚¨çš„åŒ…ä¾èµ–å…³ç³»æœ€æ–°

> åŸæ–‡ï¼š<https://www.freecodecamp.org/news/keep-package-dependencies-up-to-date-on-azure-devops/>

ä½œä¸ºä¸€åå¼€å‘äººå‘˜ï¼Œæ‚¨å¤šä¹…ä¼šçœ‹åˆ°ä¸€ä¸ªåŒ…å«è¿‡æœŸåŒ…çš„å­˜å‚¨åº“ï¼Ÿ

æ–°çš„è½¯ä»¶åŒ…æ›´æ–°é€šå¸¸åŒ…æ‹¬æ–°åŠŸèƒ½ã€æ€§èƒ½æ”¹è¿›å’Œå®‰å…¨ä¿®å¤ã€‚ä½†æ˜¯ï¼Œè·Ÿè¸ªé¡¹ç›®ä¸­æ‰€æœ‰è¿‡æ—¶çš„ä¾èµ–å…³ç³»å¯èƒ½ä¼šéå¸¸æ— èŠå’Œè€—æ—¶ï¼Œå°¤å…¶æ˜¯å½“æ‚¨æœ‰å¾ˆå¤šè¿™æ ·çš„ä¾èµ–å…³ç³»æ—¶ã€‚

æ‰€ä»¥ä¸ºäº†åšè¿™ç§å®¶åŠ¡ï¼Œæˆ‘å°è¯•äº†ä¾èµ–æœºå™¨äººã€‚

## ä¾èµ–æœºå™¨äººå¦‚ä½•å·¥ä½œ

Dependabot æ£€æŸ¥é¡¹ç›®çš„ä¾èµ–æ–‡ä»¶ã€‚ä¾‹å¦‚ï¼Œå®ƒä¼šæœç´¢æ‚¨çš„`package.json`æˆ–`pom.xml`æ–‡ä»¶ï¼Œå¹¶æ£€æŸ¥ä»»ä½•è¿‡æ—¶æˆ–ä¸å®‰å…¨çš„ä¾èµ–é¡¹ã€‚å¦‚æœæ‰¾åˆ°ä»»ä½•è¯·æ±‚ï¼Œå®ƒä¼šæ‰“å¼€å•ç‹¬çš„æ‹‰è¯·æ±‚æ¥æ›´æ–°æ¯ä¸ªè¯·æ±‚ã€‚

è¿™ä¸ªå·¥å…·æ˜¯ä¸ GitHub åŸç”Ÿé›†æˆçš„ã€‚ä½†æœ€è¿‘ï¼Œæˆ‘ä¸å¾—ä¸ä¸ºä¸€ä¸ªè¿è¡Œåœ¨ Azure DevOps ä¸­çš„é¡¹ç›®è§£å†³æ›´æ–°ä¾èµ–å…³ç³»çš„é—®é¢˜ã€‚æ‰€ä»¥æˆ‘å†³å®šæ‰¾ä¸€ä¸ªå˜é€šåŠæ³•ï¼ŒæŠŠ Dependabot å’Œ Azure Pipelines é›†æˆèµ·æ¥ã€‚åœ¨è¿™ç¯‡åšæ–‡ä¸­ï¼Œæˆ‘å°†åˆ†äº«æˆ‘çš„è§£å†³æ–¹æ¡ˆã€‚

å¦‚æœä½ å» [Azure DevOps æ‰©å±•å¸‚åœº](https://marketplace.visualstudio.com/azuredevops)æœç´¢â€œDependabotâ€ï¼Œä½ ä¼šå‘ç° Tingle è½¯ä»¶çš„ä¸€ä¸ª[æ‰©å±•](https://marketplace.visualstudio.com/items?itemName=tingle-software.dependabot)ã€‚ä½¿ç”¨è¿™ä¸ªæ‰©å±•ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å°† Dependabot ä¸ Azure DevOps ä¸­çš„ repos é›†æˆåœ¨ä¸€èµ·ã€‚

æ‚¨å¯ä»¥åœ¨ Azure DevOps çš„â€œç»„ç»‡è®¾ç½®â€ä¸­æ£€æŸ¥æ‚¨æ˜¯å¦æœ‰æ­¤æ‰©å±•ã€‚å¦‚æœæ²¡æœ‰ï¼Œè¯·ç¡®ä¿åœ¨ç»§ç»­ä¹‹å‰å®‰è£…äº†å®ƒã€‚

![1-2](img/99263a4c7f2afe46dafdcc88a93e9f63.png)

Installed Extensions - Azure DevOps

## å¦‚ä½•åˆ›å»º Azure ç®¡é“

ç°åœ¨è®©æˆ‘ä»¬ä»ä¸º azure ç®¡é“åˆ›å»ºä¸€ä¸ªæ–°çš„`YAML`æ–‡ä»¶å¼€å§‹:

```
trigger: none

stages:
  - stage: CheckDependencies
    displayName: 'Check Dependencies'
    jobs:
      - job: Dependabot
        displayName: 'Run Dependabot'
        pool:
          vmImage: 'ubuntu-latest'
        steps:
          - task: dependabot@1
            displayName: 'Run Dependabot'
            inputs:
              packageManager: 'npm'
              targetBranch: 'develop'
              openPullRequestsLimit: 10 
```

åœ¨ä»»åŠ¡å‚æ•°ä¸­ï¼Œæˆ‘æŒ‡å®šäº†ä¸‰ä¸ªå‚æ•°:

1.  **packageManager** :æŒ‡å®šæ£€æŸ¥ä¾èµ–å‡çº§çš„åŒ…çš„ç±»å‹ã€‚ä¾‹å­:`nuget`ã€`maven`ã€`gradle`ã€`npm`ç­‰ç­‰ã€‚
2.  **targetBranch** :å¯é€‰å‚æ•°ï¼Œå®šä¹‰åˆ›å»ºæ‹‰å¼è¯·æ±‚æ—¶æ‰€æŒ‡å‘çš„åˆ†æ”¯ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šï¼ŒDependabot å°†é€‰æ‹©å­˜å‚¨åº“çš„`default`åˆ†æ”¯ã€‚
3.  openPullRequestsLimit :è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰å‚æ•°ï¼ŒæŒ‡å®šä»»ä½•æ—¶å€™æ‰“å¼€çš„æ‹‰è¯·æ±‚çš„æœ€å¤§æ•°é‡ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä¸€æ¬¡æ‰“å¼€ 5 ä¸ªè¯·æ±‚ã€‚

æ‚¨å¯ä»¥é€šè¿‡æ‰©å±•æ”¯æŒçš„æ‰€æœ‰ä»»åŠ¡å‚æ•°æ¥è°ƒæ•´æ‚¨çš„å®ç°ã€‚ç°åœ¨åªéœ€ç”¨æ–°çš„ azure ç®¡é“é…ç½®è¿™ä¸ª YAML æ–‡ä»¶ï¼Œç„¶åå°±å¯ä»¥è¿è¡Œå®ƒäº†ã€‚

![3-2](img/46e70c2e256ee36d926a35016ead0a42.png)

Pipeline Configuration - Azure DevOps

ä¸‹ä¸€æ­¥æ˜¯æˆäºˆæ‚¨çš„å­˜å‚¨åº“çš„`Project Collection Build Service`è®¿é—®æƒé™ï¼Œä»¥ä¾¿ Dependabot å¯ä»¥åˆ›å»ºå¯¹é¡¹ç›®å­˜å‚¨åº“çš„ pull è¯·æ±‚ã€‚

ä¸ºæ­¤ï¼Œè¯·è½¬åˆ°æ‚¨çš„é¡¹ç›®è®¾ç½®ã€‚åœ¨è¿™é‡Œï¼Œæ‚¨å•å‡»å­˜å‚¨åº“å¹¶æœç´¢æ‚¨é›†æˆäº†ç®¡é“çš„ repoã€‚

é€‰æ‹©ä¹‹åï¼Œç‚¹å‡» security é€‰é¡¹å¡å¹¶æœç´¢**é¡¹ç›®é›†åˆæ„å»ºæœåŠ¡**ã€‚æ‚¨å¿…é¡»å…è®¸ä»¥ä¸‹ç”¨æˆ·è®¿é—®å®ƒ:

*   æåŠ©
*   å‚ä¸æ‹‰åŠ¨å¼è¯·æ±‚
*   åˆ›å»ºåˆ†æ”¯
*   åˆ›å»ºæ ‡ç­¾
*   å¼ºåˆ¶æ¨é€

![2-1](img/1cacba90f8ed9fb70c3ada9c779d42c7.png)

Access to raise PR in Repo

æœ‰äº†è¿™ä¸ªï¼Œæ‚¨å°±å®Œå…¨å¯ä»¥è¿è¡Œç®¡é“äº†ã€‚ä¸€æ—¦è¿™æ ·åšäº†ï¼Œæ‚¨å°†å¼€å§‹åœ¨æ‚¨çš„å­˜å‚¨åº“ä¸­æ¥æ”¶å¸¦æœ‰æ›´æ–°åŒ…çš„ pull è¯·æ±‚ã€‚

![5-3](img/98ffbc12005339fd1a1e1a6933b089de.png)

PR raised by Dependabot

## å¦‚ä½•å®‰æ’ç®¡é“

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨å¿…é¡»æ‰‹åŠ¨è§¦å‘ç®¡é“è¿è¡Œã€‚è¦ä½¿å…¶è‡ªåŠ¨è¿è¡Œï¼Œæ‚¨å¯ä»¥ä¸ºç®¡é“é…ç½®è®¡åˆ’ã€‚è¿™å°†è§¦å‘æ‚¨çš„ç®¡é“æ ¹æ®è®¡åˆ’å¯åŠ¨ã€‚

ä½¿ç”¨ä»¥ä¸‹è¯­æ³•å¹¶å°†å…¶æ·»åŠ åˆ°æ‚¨çš„`YAML`æ–‡ä»¶çš„æœ€é¡¶ç«¯:

```
schedules:
- cron: string
  displayName: string
  branches:
    include: [ string ]
  always: boolean 
```

åˆ†æ”¯æœºæ„**sâ€™**å‚æ•°æŒ‡å®šè°ƒåº¦åº”ç”¨äºå“ªäº›åˆ†æ”¯æœºæ„ã€‚

`always`å‚æ•°æŒ‡å®šæ˜¯â€œæ€»æ˜¯â€è¿è¡Œç®¡é“ï¼Œè¿˜æ˜¯ä»…åœ¨è‡ªä¸Šæ¬¡æˆåŠŸè°ƒåº¦è¿è¡Œä»¥æ¥æœ‰ä»»ä½•æºä»£ç æ›´æ”¹çš„æƒ…å†µä¸‹è¿è¡Œç®¡é“ã€‚é»˜è®¤å€¼ä¸º falseã€‚

å¯¹äºè¿™ç§æƒ…å†µï¼Œæ‚¨å°†å®ƒçš„å€¼è®¾ç½®ä¸º **true** ï¼Œå› ä¸º dependent bot æ›´æ–°ç‹¬ç«‹äºä»»ä½•ä»£ç æ›´æ”¹ã€‚

cron è®¡åˆ’çš„æ—¶åŒºæ˜¯ UTCï¼Œcron è¯­æ³•å¦‚ä¸‹:

```
mm HH DD MM DW
 \  \  \  \  \__ Days of week
  \  \  \  \____ Months
   \  \  \______ Days
    \  \________ Hours
     \__________ Minutes 
```

å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³åœ¨ UTC æ—¶é—´æ¯å‘¨å‘¨æ—¥ä¸‹åˆ 12 ç‚¹è¿è¡Œæ‚¨çš„ç®¡é“ï¼Œæ‚¨éœ€è¦ç¼–å†™- `cron: "0 12 * * 0"`(æ›´æ–° cron ä»¥æ»¡è¶³æ‚¨çš„éœ€æ±‚)ã€‚

æ·»åŠ æ—¶é—´è¡¨åï¼Œæœ€ç»ˆçš„`YAML`åº”è¯¥æ˜¯è¿™æ ·çš„:

```
schedules:
  - cron: "0 12 * * 0"
    displayName: Weekly Dependency Updates
    branches:
      include:
      - develop
    always: true

trigger: none

stages:
  - stage: CheckDependencies
    displayName: 'Check Dependencies'
    jobs:
      - job: Dependabot
        displayName: 'Run Dependabot'
        pool:
          vmImage: 'ubuntu-latest'
        steps:
          - task: dependabot@1
            displayName: 'Run Dependabot'
            inputs:
              packageManager: 'npm'
              targetBranch: 'develop'
              openPullRequestsLimit: 10 
```

è¯¥ç®¡é“ä¸ºæ‚¨åšäº†ä»¥ä¸‹å·¥ä½œ:

å®ƒæ¯å‘¨è¿è¡Œä¸€æ¬¡(åœ¨æœ¬ä¾‹ä¸­ä¸º UTC æ—¶é—´å‘¨æ—¥ä¸‹åˆ 12 ç‚¹),å¹¶æŸ¥æ‰¾ä»»ä½•è¿‡æ—¶æˆ–ä¸å®‰å…¨çš„ä¾èµ–é¡¹ã€‚å¦‚æœæ‰¾åˆ°ä»»ä½•è¯·æ±‚ï¼Œå®ƒå°†æ‰“å¼€æ‹‰è¯·æ±‚æ¥å•ç‹¬æ›´æ–°æ¯ä¸ªè¯·æ±‚ã€‚

å¸Œæœ›è¿™å°†å¸®åŠ©ä½ åœ¨ Azure DevOps ä¸­ä¿æŒä½ çš„é¡¹ç›®ä¾èµ–å…³ç³»æœ€æ–°ï¼

## åŒ…æ‰

å°±è¿™æ ·ï¼Œæˆ‘ä»¬åˆ°äº†æ–‡ç« çš„ç»“å°¾ã€‚å¦‚æœæ‚¨æƒ³è¿›ä¸€æ­¥è®¨è®ºä»»ä½•æŠ€æœ¯è¯é¢˜ï¼Œæˆ–è€…æ‚¨æœ‰ä»»ä½•é—®é¢˜ã€å»ºè®®æˆ–åé¦ˆï¼Œæˆ‘çš„ DMs éšæ—¶æ¬¢è¿æ‚¨:

*   [æ¨ç‰¹](https://twitter.com/apoorv__tyagi)
*   [LinkedIn](https://www.linkedin.com/in/apoorvtyagi/)
*   [GitHub](https://github.com/apoorvtyagi)
*   [åšå®¢](https://apoorvtyagi.tech/)

å¿«ä¹å­¦ä¹ ï¼ğŸ’» ğŸ˜„